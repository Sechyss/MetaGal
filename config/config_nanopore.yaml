# ── Nanopore MinION pipeline configuration ───────────────────────────────────
#
# Configuration template for Oxford Nanopore MinION 16S amplicon data.
#
# Copy this file, adjust the paths and parameters for your project,
# then run:
#
#   python pipeline.py --config config/config_nanopore.yaml
#
# For data exported from Epi2me, first run the import helper:
#
#   python scripts/epi2me_import.py \
#       --epi2me-dir /path/to/epi2me_output \
#       --sample-sheet /path/to/sample_sheet.csv \
#       --output-dir data/raw \
#       --manifest data/manifest_nanopore.tsv
#
# Then point 'samples' below to the generated manifest.
# ─────────────────────────────────────────────────────────────────────────────

# Root directory for all pipeline outputs
output_dir: results

# Number of CPU threads available for tools that support parallelism
threads: 4

# Sequencing platform – must be 'nanopore' for this configuration
sequencing_platform: nanopore

# ── Samples ───────────────────────────────────────────────────────────────────
# Option A – inline list (one FASTQ file per sample)
samples:
  sample_01:
    reads: data/raw/sample_01.fastq.gz
  sample_02:
    reads: data/raw/sample_02.fastq.gz

# Option B – TSV manifest generated by scripts/epi2me_import.py
# samples: data/manifest_nanopore.tsv   # columns: sample, reads

# ── Sample metadata ───────────────────────────────────────────────────────────
metadata: data/metadata.tsv
group_column: treatment

# ── Steps to run ──────────────────────────────────────────────────────────────
steps:
  quality_control: true
  trimming: true
  denoising: true
  taxonomy: true
  diversity: true
  visualisation: true

# ── Trimming / quality filtering (NanoFilt + optional cutadapt) ───────────────
trimming:
  min_length: 200        # minimum read length to keep after filtering
  max_length: 2000       # maximum read length (comment out for no upper limit)
  min_quality: 8.0       # minimum mean Phred quality score

  # Optional primer removal after NanoFilt.
  # Set primer_set OR provide explicit forward_primer / reverse_primer.
  # Built-in sets: 515F_806R (V4), 27F_338R (V1-V2), 341F_806R (V3-V4)
  primer_set: 515F_806R

  # Custom primers (uncomment to override primer_set):
  # forward_primer: GTGYCAGCMGCCGCGGTAA
  # reverse_primer: GGACTACNVGGGTWTCTAAT

# ── DADA2 denoising (single-end) ─────────────────────────────────────────────
dada2:
  trunc_len: 0   # 0 = no truncation (recommended for variable-length Nanopore reads)

# ── Taxonomic classification ──────────────────────────────────────────────────
taxonomy:
  method: vsearch

  # VSEARCH: SILVA or GreenGenes2 FASTA database
  database: data/silva_138_99_seqs.fasta

  # Lower identity threshold to account for higher Nanopore error rates
  identity: 0.85

  # QIIME 2 classifier (uncomment to use instead of vsearch):
  # method: qiime2
  # classifier: data/silva-138-99-nb-classifier.qza

# ── Visualisation ─────────────────────────────────────────────────────────────
taxonomy_level: Phylum
top_n_taxa: 10
